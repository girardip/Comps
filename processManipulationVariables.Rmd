---
title: "Manipulation of Variables"
author: "Pedro Girardi"
date: "December 11, 2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(data.table)
```

## Importing STATA Exported .csvs and selecting variables of interest

```{r, eval=F}
setwd("PME_stata/")#set directory to where the STATA csv files are
listOfCsv = list.files()# get a list of all files

# create data frame with one of the files (Selecting for the variables of interest)
stataCsv = fread(file = listOfCsv[[1]]) %>% 
  select(v035, v040, v050, v070, v203, v4191, v208,
         v301, v307, v234, vD23df, vD24df, vD25df, 
         vD26df, p201, idind) 

# runs for loop that reads one file and appends rows of columns of interest to previous df
for (fileCsv in listOfCsv[-1]){
  currentFile = fread(file = fileCsv) %>% 
  select(v035, v040, v050, v070, v203, v4191, v208,
         v301, v307, v234, vD23df, vD24df, vD25df, 
         vD26df, p201, idind)
  stataCsv = bind_rows(stataCsv, currentFile)
}
# fwrite(stataCsv, "finalPME.csv")
```

## Labeling and Income

```{r, eval=F}
# PME relabeling (depends on what variables I imported)
reduced_pme = read.csv("~/Comps/pme_reduced.csv")
reduced_pme = reduced_pme[,-c(1)]
names(reduced_pme) = c("Gender", "Month", "Household", "MetropolitanArea", "Income")

# manipulation of income variable
mean(is.na(reduced_pme$Income))
mean(reduced_pme$Income==0, na.rm=T) 
#there are people with income of 0. I will add $1 to all incomes so we don't have issues with log
# only getting the observations with income
percentiles_income = quantile(reduced_pme$Income, probs = 1:100/100, na.rm=T)# some percentiles are off at the very top (people making 10^9 reals)
reduced_pme = reduced_pme %>% filter(Income<1e6)
reduced_pme = reduced_pme[complete.cases(reduced_pme),]
reduced_pme$logIncome = log(reduced_pme$Income+1)
reduced_pme$MetropolitanArea = as.factor(reduced_pme$MetropolitanArea)
summary(reduced_pme)
```

```{r, eval=F}
# Income Modifications
colnames(fullDf)[6]="Income"
fullDf = fullDf %>% filter(Income<1e6, Income>0)
fullDf = fullDf[complete.cases(fullDf),]
fullDf$logIncome = log(fullDf$Income+1)
# manipulation of income variable
mean(is.na(reduced_pme$Income))
mean(reduced_pme$Income==0, na.rm=T) 
#there are people with income of 0. I will add $1 to all incomes so we don't have issues with log
# only getting the observations with income
percentiles_income = quantile(reduced_pme$Income, probs = 1:100/100, na.rm=T)# some percentiles are off at the very top (people making 10^9 reals)
reduced_pme = reduced_pme %>% filter(Income<1e6)
reduced_pme = reduced_pme[complete.cases(reduced_pme),]
reduced_pme$logIncome = log(reduced_pme$Income+1)
reduced_pme$MetropolitanArea = as.factor(reduced_pme$MetropolitanArea)
# summary(reduced_pme)
# hist(reduced_pme$logIncome) # I should probably remove the 0s and they will be overly influential 
reduced_pme = reduced_pme %>% filter(Income>0)
```